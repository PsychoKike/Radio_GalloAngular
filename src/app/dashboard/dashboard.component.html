<div class="container-fluid min-vh-100 bg-black text-white p-4 d-flex flex-column align-items-center justify-content-center">



  <h2 class="mb-4 fw-bold">ğŸ›ï¸ Consola de Mezcla</h2>



  <div class="row w-100 g-4" style="max-width: 1000px;">

   

    <div class="col-md-6">

      <div class="card bg-dark border-secondary h-100 shadow-lg">

        <div class="card-header border-secondary bg-transparent text-center">

          <h5 class="text-primary mb-0 fw-bold">ğŸ™ï¸ MicrÃ³fono</h5>

        </div>

        <div class="card-body p-4">

         

          <label class="form-label text-muted small">Dispositivo de entrada</label>

          <select class="form-select bg-black text-white border-secondary mb-4"

                  [(ngModel)]="selectedMicId"

                  (change)="onMicChange()">

              @for (device of availableMics; track device.deviceId) {

                <option [value]="device.deviceId">{{ device.label || 'Micro GenÃ©rico' }}</option>

              }

          </select>



          <div class="d-flex justify-content-between mb-2">

            <label for="micRange" class="form-label fw-bold">Volumen Voz</label>

            <span class="badge bg-primary">{{ VozVol }}%</span>

          </div>

         

          <div class="d-flex align-items-center">

            <input type="range"

                   class="form-range"

                   min="0" max="100"

                   id="micRange"

                   [(ngModel)]="VozVol"

                   (input)="updateMicVolume()"

                   [disabled]="!micActive">

          </div>

        </div>

      </div>

    </div>



    <div class="col-md-6">

      <div class="card bg-dark border-secondary h-100 shadow-lg">

        <div class="card-header border-secondary bg-transparent text-center">

          <h5 class="text-success mb-0 fw-bold">ğŸµ MÃºsica de Fondo</h5>

        </div>

        <div class="card-body p-4">

         

          <label class="form-label text-muted small">Fuente de audio</label>

          <button class="btn w-100 mb-4 py-2 border-secondary text-white"

                  [ngClass]="musicActive ? 'btn-success' : 'btn-outline-secondary'"

                  (click)="openAppSelector()">

              {{ musicActive ? 'âœ… Fuente Seleccionada' : 'ğŸ” Seleccionar PestaÃ±a/Ventana' }}

          </button>



          <div class="d-flex justify-content-between mb-2">

            <label for="musicRange" class="form-label fw-bold">Volumen Fondo</label>

            <span class="badge bg-success">{{ musiVol }}%</span>

          </div>



          <div class="d-flex align-items-center">

            <input type="range"

                   class="form-range"

                   min="0" max="100"

                   id="musicRange"

                   [(ngModel)]="musiVol"

                   (input)="updateMusicVolume()"

                   [disabled]="!musicActive">

          </div>

        </div>

      </div>

    </div>



    <div class="col-12">

      <div class="card bg-black border-secondary shadow-sm">

        <div class="card-header border-secondary p-1 text-center">

           <small class="text-muted text-uppercase fw-bold" style="letter-spacing: 2px;">Visualizador de Salida</small>

        </div>

      <div class="col-12">
      <div class="card bg-dark border-secondary shadow-sm">
        <div class="card-header border-secondary p-2 text-center d-flex justify-content-between align-items-center">
           <span class="badge bg-danger animate__animated animate__pulse animate__infinite">EN VIVO</span>
           <small class="text-muted text-uppercase fw-bold" style="letter-spacing: 2px;">Monitoreo de Audiencia (Icecast)</small>
           
        </div>
        <div class="card-body p-2" style="height: 320px; background: #1a1a1a;">
            
            <app-grafica-escuchas></app-grafica-escuchas>

        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card bg-black border-info shadow-lg overflow-hidden position-relative">
        
        <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(13,202,240,0.1) 0%, rgba(0,0,0,0) 70%); pointer-events: none;"></div>

        <div class="card-body p-3 d-flex justify-content-between align-items-center position-relative">
          
          <div class="d-flex align-items-center">
            <div class="bg-info text-black rounded p-2 me-3 d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
              <span class="fs-2">ğŸŒ¡ï¸</span>
            </div>
            <div>
              <h6 class="text-info text-uppercase mb-0 fw-bold" style="letter-spacing: 1px;">Condiciones de Cabina</h6>
              
              @if (climaData) {
                <small class="text-muted">
                  ğŸ“ {{ climaData.name }} | ğŸ“… {{ currentDate | date:'shortTime' }}
                </small>
              }
            </div>
          </div>

          @if (climaData) {
            <div class="d-flex align-items-center">
              
              <img [src]="'http://openweathermap.org/img/wn/' + climaData.weather[0].icon + '@2x.png'" 
                  alt="icono clima" 
                  style="filter: drop-shadow(0 0 5px rgba(255,255,255,0.5)); width: 60px;">
                  
              <div class="me-4 text-end">
                <h2 class="text-white mb-0 fw-bold display-6" style="text-shadow: 0 0 10px rgba(13,202,240,0.6);">
                  {{ Math.round(climaData.main.temp) }}Â°C
                </h2>
                <span class="badge bg-dark border border-secondary text-info">
                  {{ climaData.weather[0].description }}
                </span>
              </div>

              <div class="d-none d-md-block border-start border-secondary ps-3">
                <div class="d-flex justify-content-between text-muted small mb-1" style="min-width: 120px;">
                  <span>ğŸ’§ Humedad:</span>
                  <span class="text-white fw-bold">{{ climaData.main.humidity }}%</span>
                </div>
                <div class="d-flex justify-content-between text-muted small">
                  <span>ğŸ’¨ Viento:</span>
                  <span class="text-white fw-bold">{{ climaData.wind.speed }} m/s</span>
                </div>
              </div>
            </div>
          } @else {
            <div class="text-info spinner-border spinner-border-sm" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          }

        </div>
      </div>
    </div>



    <div class="col-12">

      <div class="card bg-dark border-secondary shadow-lg">

        <div class="card-body p-4 text-center">

            <button class="btn btn-lg w-100 py-3 fw-bold shadow-sm"

                    (click)="toggleTransmission()"

                    [class.btn-danger]="isTransmitting"

                    [class.btn-outline-light]="!isTransmitting">

              <span class="fs-4">

                {{ isTransmitting ? 'â¹ DETENER TRANSMISIÃ“N' : 'ğŸ”´ INICIAR TRANSMISIÃ“N' }}

              </span>

            </button>

        </div>

      </div>

    </div>



  </div>

</div>